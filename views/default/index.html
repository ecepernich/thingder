{{extend 'layout.html'}}

<html>
   <h2>Welcome to Thingder!</h2>
    <br>
    <h3>Item posts</h3>

    <form {{if not len(request.args): }}action="showByCategory" {{pass}} {{if len(request.args): }} action="../showByCategory"{{pass}} method="post">
        <select id="category_name" name='filter1'>
            <option disabled selected>Category</option>
            <option>Computers</option>
            <option>Car</option>
            <option>Electronics</option>
            <option>House</option>
            <option>Video Games</option>
            <option>Misc.</option>
            <input id="category_button" style="margin: 10px; height: 40px" type="submit" value="filter" disabled>
        </select>
    </form>
    <form {{if not len(request.args): }}action="showByLocations" {{pass}} {{if len(request.args): }} action="../showByLocations"{{pass}} method="post">
        <select id="location_name" name='filter2'>
            <option disabled selected>Location</option>
            <option>Bakersfield</option>
            <option>Chico</option>
            <option>Fresno</option>
            <option>Gold Country</option>
            <option>Hanford</option>
            <option>Inland Empire</option>
            <option>Las Vegas</option>
            <option>Los Angeles</option>
            <option>Mercred</option>
            <option>Modestro</option>
            <option>Orange Co</option>
            <option>Palm Springs</option>
            <option>Reno</option>
            <option>Sacramento</option>
            <option>San Luis Obispo</option>
            <option>Santa Barbara</option>
            <option>Stockton</option>
            <option>San Jose</option>
            <option>Santa Cruz</option>
            <input id="location_button" style="margin: 10px; height: 40px" type="submit" value="Location" disabled>
        </select>
    </form>

   <!-- <div class="container-fluid">
        <div class="row">
        {{for row in rows:}}
                <div class="col-md-3">
                    <div id="card">
                        <h3><a href="{{=URL('show',args=row.id)}}">{{=row.title}}</a></h3>
                        <p>Created by: <a href="{{=URL('show_profile',args=row.created_by.id)}}">{{=row.created_by.first_name}}</a></p>
                        <p>Created on: {{=row.created_on}}</p>
                        <p>Interested in: {{=row.interests}}</p>
                        <p>Offering: {{=row.offers}}</p>
                        {{if row.image:}}
                        <img vertical-align="" width="190px" src="{{=URL('download', args=row.image)}}"/>
                        {{pass}}
                    </div>
                </div>
        {{pass}}
        </div>
    </div> -->
    <table class="table">
    {{for i,row in enumerate(rows):}}
{{if i==items_per_page: break}}
<div class="col-md-3"><td>
                    <div id="card">
                        {{if len(row.title) > 25:}}
                        <h3><a href="{{=URL('show',args=row.id)}}">{{=row.title[:23] + "..."}}</a></h3>
                        {{else:}}
                        <h3><a href="{{=URL('show',args=row.id)}}">{{=row.title}}</a></h3>
                        {{pass}}
                        {{if len(row.created_by.first_name) > 17:}}
                         <p>Created by: <a href="{{=URL('show_profile',args=row.created_by.id)}}">{{=row.created_by.first_name[:14] + "..."}}</a></p>
                        {{else:}}
                        <p>Created by: <a href="{{=URL('show_profile',args=row.created_by.id)}}">{{=row.created_by.first_name}}</a></p>
                        {{pass}}
                        {{if len(row.interests) > 17:}}
                        <p>Interested in: {{=row.interests[:14] + "..."}}</p>
                        {{else:}}
                        <p>Interested in: {{=row.interests}}</p>
                        {{pass}}
                        {{if len(row.offers) > 17:}}
                        <p>Offering: {{=row.offers[:14] + "..."}}</p>
                        {{else:}}
                        <p>Offering: {{=row.offers}}</p>
                        {{pass}}
                        {{if row.image:}}
                        <img vertical-align="" width="190px" src="{{=URL('download', args=row.image)}}"/>
                        {{pass}}
                        <h4><a href={{if db(db.profile.User_ID == row.created_by).select():rows2=db(db.profile.User_ID == row.created_by).select()[0]}} {{if rows2.zip_code:}}"{{=URL('test_map',args=[row.locations,rows2.zip_code])}}"{{pass}} 
                               {{if not rows2.zip_code:}}"{{=URL('test_map',args=row.locations)}}"{{pass}}>Show on map</a></h4>
                    </div>
        </div><br /></td>
    
{{pass}}
    </table>
{{if page:}}
<a href="{{=URL(args=[page-1])}}">previous</a>
{{pass}}
<b>|</b>
{{if len(rows)>items_per_page:}}
<a href="{{=URL(args=[page+1])}}">next</a>
{{pass}}
</html>
<script>
    // Input box is initially disabled if a category is not specified. When a category is chosen, remove the disabled property from input
    // so that the box is usable - Joseph Campuzano
    $(document).ready(function() {
        var e = document.getElementById("category_name")
        var f = document.getElementById("location_name")
        var input = document.getElementById("category_button")
        var input2 = document.getElementById("location_button")
        $(e).click(function() {
            if (e.selectedIndex > 0) {
                input.removeAttribute("disabled");
            }
        });
        
        $(f).click(function() {
            if (f.selectedIndex > 0) {
                input2.removeAttribute("disabled");
            }
        });
    });
    /* Javascript for search bar auto complete */
    $(function() {
    var availableTags = [
    {{recepients = db(db.auth_user).select()}}
        {{l=[]}}
    {{for user in recepients:}}
    {{l.append(user.first_name)}}
    {{pass}}
      {{ for x in l:}}
        {{if x == l[len(l)-1]:}} 
            "{{=x}}"
    {{else:}} "{{=x}}",
{{pass}}
    {{pass}}
    ];
    $( "#search" ).autocomplete({
      source: availableTags
      
    });
  });
 

                      
</script>

 <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8lo8mW7zn9oahWIJ4Eo4ig_gVI4g-aUA&callback=initMap"
    async defer></script>
  </body>
</html>
